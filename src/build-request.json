{
  "kind": "build_request",
  "title": "Add offline-accessible gameplay mode (playable without backend availability)",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-62",
      "text": "Add an explicit \"Offline Mode\" launch path so the game can be started and continued without any backend canister calls when the backend is unavailable (or when the user has no network connection).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "Make the game always accessable even if it is offline."
        ]
      },
      "acceptanceCriteria": [
        "When backend availability is unhealthy/unreachable, the user can still enter gameplay from the title screen without seeing the launch error screen.",
        "Starting gameplay via the offline path does not call startNewGame(), continueGame(), isAvailable(), or any other backend actor methods.",
        "All user-facing UI text related to offline mode is in English."
      ]
    },
    {
      "id": "REQ-63",
      "text": "Update the title screen to allow play while offline: keep the existing server status indicator/alert for admins, but do not disable gameplay entry when the server is Offline. Provide clear English messaging that progress will be stored locally while offline.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "Make the game always accessable even if it is offline."
        ]
      },
      "acceptanceCriteria": [
        "On the title screen, \"New Game\" and \"Continue\" are not disabled solely due to backendAvailability being offline/unhealthy.",
        "If the server is Offline, the title screen shows an English notice such as \"Server Offline â€” you can still play in Offline Mode. Progress will be saved on this device.\"",
        "If the user is an admin and the server is Offline, the existing server-unavailable alert can remain, but it must not block offline play."
      ]
    },
    {
      "id": "REQ-64",
      "text": "Implement local-only game launching behavior in App.tsx: when backend preflight fails for New Game or Continue, fall back to launching offline gameplay instead of routing to the launch-error screen.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "Make the game always accessable even if it is offline."
        ]
      },
      "acceptanceCriteria": [
        "In frontend/src/App.tsx, handleNewGame() launches gameplay (currentScreen='game', isNewGame=true) even when backendAvailability.isHealthy is false.",
        "In frontend/src/App.tsx, handleContinue() launches gameplay (currentScreen='game', isNewGame=false) even when backendAvailability.isHealthy is false.",
        "When the offline fallback is used, diagnostics.lastLaunchAction still reflects the user action (new-game/continue), and diagnostics.userFriendlySummary reflects an English offline message rather than a server failure message."
      ]
    },
    {
      "id": "REQ-65",
      "text": "Add a local-save presence signal to drive \"Continue\" behavior in offline mode, using the existing persisted Zustand store as the source of truth.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "Make the game always accessable even if it is offline."
        ]
      },
      "acceptanceCriteria": [
        "The game persists a boolean (or equivalent) indicating a local save exists (e.g., set after the first meaningful progress such as any state change or after first entering gameplay).",
        "If no local save exists, \"Continue\" is disabled (or shows an English message explaining there is no local save to continue) regardless of backend availability.",
        "If a local save exists, \"Continue\" works in offline mode and loads the locally persisted state."
      ]
    },
    {
      "id": "REQ-66",
      "text": "Ensure offline mode does not introduce backend coupling elsewhere: gameplay UI interactions must remain functional without backend calls (dialogue choices, activities, letters, customization, moments, endings) and must continue using the local Zustand store as they do today.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "Make the game always accessable even if it is offline."
        ]
      },
      "acceptanceCriteria": [
        "With the network disconnected (or backend canister stopped), the user can still: open dialogue, make choices, complete activities, write letters and receive local responses, place customization items, and view unlocked moments/endings without errors.",
        "No new runtime errors appear due to missing backend actor or failed React Query calls during offline gameplay.",
        "No UI copy claims the app can start/stop/restart the backend canister."
      ]
    }
  ],
  "constraints": [
    "Frontend immutable paths must not be edited: frontend/src/hooks/useInternetIdentity.ts, frontend/src/hooks/useInternetIdentity.tsx, frontend/src/hooks/useActor.ts, frontend/src/main.tsx, frontend/src/components/ui.",
    "Backend remains single-actor in backend/main.mo; do not introduce additional backend services.",
    "All user-facing text introduced/changed for this request must be in English."
  ],
  "nonGoals": [
    "Implementing bidirectional sync between offline local progress and backend canister state.",
    "Guaranteeing offline availability of Internet Identity authentication flows.",
    "Adding service worker/PWA offline asset caching beyond what already exists."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}